/**
 * Shared database cleanup utility for integration tests.
 * Uses TRUNCATE CASCADE to properly handle all FK dependencies.
 */
import { PrismaService } from '../../src/database/prisma/prisma.service';

/**
 * Clean all application data from the test database.
 * Uses raw SQL TRUNCATE CASCADE to avoid FK ordering issues.
 * This is safe for tests because each test should set up its own data.
 */
export async function cleanDatabase(prisma: PrismaService): Promise<void> {
  await prisma.$executeRawUnsafe(`
    TRUNCATE TABLE
      accrued_bank_charges,
      ad_hoc_charges,
      agent_audit_logs,
      agent_decisions,
      asset_returns,
      audit_logs,
      bank_connections,
      bank_statement_matches,
      broadcast_messages,
      bulk_operation_logs,
      calculation_item_cache,
      categorization_journals,
      categorization_metrics,
      categorizations,
      chart_of_accounts,
      children,
      contact_submissions,
      correction_feedback,
      credit_balances,
      demo_requests,
      duplicate_resolutions,
      employee_number_counters,
      employee_setup_logs,
      enrollments,
      feature_flags,
      fee_structures,
      impersonation_sessions,
      invitations,
      invoice_delivery_logs,
      invoice_lines,
      invoice_number_counters,
      invoices,
      leave_requests,
      linked_bank_accounts,
      linked_bank_sync_events,
      manual_match_history,
      message_recipients,
      onboarding_checklist_items,
      onboarding_progress,
      opening_balance_imports,
      opening_balances,
      parent_generated_documents,
      parents,
      payee_patterns,
      payment_gateway_transactions,
      payment_links,
      payments,
      payroll_adjustments,
      payroll_journal_lines,
      payroll_journals,
      payrolls,
      payrun_syncs,
      pending_syncs,
      profile_mapping_sync,
      quote_lines,
      quote_number_counters,
      quotes,
      recipient_groups,
      reconciliations,
      reminder_configs,
      reminder_templates,
      reminders,
      report_requests,
      sars_submissions,
      service_period_syncs,
      shadow_comparisons,
      simplepay_connections,
      simplepay_employee_mappings,
      simplepay_payslip_imports,
      split_match_components,
      split_matches,
      staff,
      staff_documents,
      staff_generated_documents,
      staff_offboardings,
      staff_onboardings,
      statement_lines,
      statements,
      supplier_bill_lines,
      supplier_bill_payments,
      supplier_bills,
      suppliers,
      sync_conflicts,
      tenants,
      transactions,
      ui19_submissions,
      user_tenant_roles,
      users,
      vat_adjustments,
      webhook_logs,
      whatsapp_messages,
      xero_account_mappings,
      xero_accounts,
      xero_contact_mappings,
      xero_invoice_mappings,
      xero_oauth_states,
      xero_payment_mappings,
      xero_tokens,
      xero_transaction_splits
    CASCADE
  `);
}
