// CrecheBooks Prisma Schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ENUMS
// ============================================

enum TaxStatus {
  VAT_REGISTERED
  NOT_REGISTERED
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  SUSPENDED
  CANCELLED
}

enum UserRole {
  OWNER
  ADMIN
  VIEWER
  ACCOUNTANT
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  CATEGORIZE
  MATCH
  RECONCILE
  SUBMIT
}

enum ImportSource {
  BANK_FEED
  CSV_IMPORT
  PDF_IMPORT
  MANUAL
}

enum TransactionStatus {
  PENDING
  CATEGORIZED
  REVIEW_REQUIRED
  SYNCED
}

enum VatType {
  STANDARD
  ZERO_RATED
  EXEMPT
  NO_VAT
}

enum CategorizationSource {
  AI_AUTO
  AI_SUGGESTED
  USER_OVERRIDE
  RULE_BASED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum PreferredContact {
  EMAIL
  WHATSAPP
  BOTH
}

enum FeeType {
  FULL_DAY
  HALF_DAY
  HOURLY
  CUSTOM
}

enum EnrollmentStatus {
  ACTIVE
  PENDING
  WITHDRAWN
  GRADUATED
}

enum InvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PARTIALLY_PAID
  PAID
  OVERDUE
  VOID
}

enum DeliveryMethod {
  EMAIL
  WHATSAPP
  BOTH
}

enum DeliveryStatus {
  PENDING
  SENT
  DELIVERED
  OPENED
  FAILED
}

enum LineType {
  MONTHLY_FEE
  REGISTRATION
  EXTRA
  DISCOUNT
  CREDIT
}

enum MatchType {
  EXACT
  PARTIAL
  MANUAL
  OVERPAYMENT
}

enum MatchedBy {
  AI_AUTO
  USER
}

enum EmploymentType {
  PERMANENT
  CONTRACT
  CASUAL
}

enum PayFrequency {
  MONTHLY
  WEEKLY
  DAILY
  HOURLY
}

enum PayrollStatus {
  DRAFT
  APPROVED
  PAID
}

enum SubmissionType {
  VAT201
  EMP201
  IRP5
}

enum SubmissionStatus {
  DRAFT
  READY
  SUBMITTED
  ACKNOWLEDGED
}

enum ReconciliationStatus {
  IN_PROGRESS
  RECONCILED
  DISCREPANCY
}

enum EscalationLevel {
  FRIENDLY
  FIRM
  FINAL
}

enum ReminderStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

// ============================================
// MODELS
// ============================================

model Tenant {
  id                 String             @id @default(uuid())
  name               String             @db.VarChar(200)
  tradingName        String?            @map("trading_name") @db.VarChar(200)
  registrationNumber String?            @map("registration_number") @db.VarChar(50)
  vatNumber          String?            @map("vat_number") @db.VarChar(20)
  taxStatus          TaxStatus          @default(NOT_REGISTERED) @map("tax_status")
  addressLine1       String             @map("address_line1") @db.VarChar(200)
  addressLine2       String?            @map("address_line2") @db.VarChar(200)
  city               String             @db.VarChar(100)
  province           String             @db.VarChar(50)
  postalCode         String             @map("postal_code") @db.VarChar(10)
  phone              String             @db.VarChar(20)
  email              String             @unique @db.VarChar(255)
  xeroTenantId       String?            @unique @map("xero_tenant_id") @db.VarChar(50)
  subscriptionStatus SubscriptionStatus @default(TRIAL) @map("subscription_status")
  invoiceDayOfMonth  Int                @default(1) @map("invoice_day_of_month")
  invoiceDueDays     Int                @default(7) @map("invoice_due_days")
  closureDates       Json               @default("[]") @map("closure_dates")
  createdAt          DateTime           @default(now()) @map("created_at")
  updatedAt          DateTime           @updatedAt @map("updated_at")

  users            User[]
  transactions     Transaction[]
  payeePatterns    PayeePattern[]
  feeStructures    FeeStructure[]
  enrollments      Enrollment[]
  parents          Parent[]
  children         Child[]
  invoices         Invoice[]
  payments         Payment[]
  staff            Staff[]
  payrolls         Payroll[]
  sarsSubmissions  SarsSubmission[]
  reconciliations  Reconciliation[]
  xeroToken        XeroToken?
  reminders        Reminder[]

  @@map("tenants")
}

model User {
  id          String    @id @default(uuid())
  tenantId    String    @map("tenant_id")
  tenant      Tenant    @relation(fields: [tenantId], references: [id])
  auth0Id     String    @unique @map("auth0_id")
  email       String
  name        String
  role        UserRole
  isActive    Boolean   @default(true) @map("is_active")
  lastLoginAt DateTime? @map("last_login_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  reviewedCategorizations Categorization[] @relation("ReviewedCategorizations")
  sarsSubmissions         SarsSubmission[]
  reconciliations         Reconciliation[] @relation("ReconciliationReconciler")

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([auth0Id])
  @@map("users")
}

model AuditLog {
  id            String      @id @default(uuid())
  tenantId      String      @map("tenant_id")
  userId        String?     @map("user_id")
  agentId       String?     @map("agent_id")
  entityType    String      @map("entity_type")
  entityId      String      @map("entity_id")
  action        AuditAction
  beforeValue   Json?       @map("before_value")
  afterValue    Json?       @map("after_value")
  changeSummary String?     @map("change_summary")
  ipAddress     String?     @map("ip_address") @db.VarChar(45)
  userAgent     String?     @map("user_agent")
  createdAt     DateTime    @default(now()) @map("created_at")

  // NOTE: No @updatedAt - this table is IMMUTABLE
  // NOTE: No foreign keys - intentional for immutability

  @@index([tenantId, entityType, entityId])
  @@index([tenantId, createdAt])
  @@index([userId, createdAt])
  @@map("audit_logs")
}

model Transaction {
  id                String            @id @default(uuid())
  tenantId          String            @map("tenant_id")
  xeroTransactionId String?           @unique @map("xero_transaction_id")
  bankAccount       String            @map("bank_account") @db.VarChar(50)
  date              DateTime          @db.Date
  description       String
  payeeName         String?           @map("payee_name") @db.VarChar(200)
  reference         String?           @db.VarChar(100)
  amountCents       Int               @map("amount_cents")
  isCredit          Boolean           @map("is_credit")
  source            ImportSource
  importBatchId     String?           @map("import_batch_id")
  status            TransactionStatus @default(PENDING)
  isReconciled      Boolean           @default(false) @map("is_reconciled")
  reconciledAt      DateTime?         @map("reconciled_at")
  isDeleted         Boolean           @default(false) @map("is_deleted")
  deletedAt         DateTime?         @map("deleted_at")
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  categorizations Categorization[]
  payments        Payment[]

  @@index([tenantId, date])
  @@index([tenantId, status])
  @@index([tenantId, payeeName])
  @@index([tenantId, isReconciled])
  @@map("transactions")
}

model Categorization {
  id               String               @id @default(uuid())
  transactionId    String               @map("transaction_id")
  accountCode      String               @map("account_code") @db.VarChar(20)
  accountName      String               @map("account_name") @db.VarChar(100)
  confidenceScore  Decimal              @map("confidence_score") @db.Decimal(5, 2)
  reasoning        String?
  source           CategorizationSource
  isSplit          Boolean              @default(false) @map("is_split")
  splitAmountCents Int?                 @map("split_amount_cents")
  vatAmountCents   Int?                 @map("vat_amount_cents")
  vatType          VatType              @default(STANDARD) @map("vat_type")
  reviewedBy       String?              @map("reviewed_by")
  reviewedAt       DateTime?            @map("reviewed_at")
  createdAt        DateTime             @default(now()) @map("created_at")
  updatedAt        DateTime             @updatedAt @map("updated_at")

  transaction Transaction @relation(fields: [transactionId], references: [id])
  reviewer    User?       @relation("ReviewedCategorizations", fields: [reviewedBy], references: [id])

  @@index([transactionId])
  @@index([accountCode])
  @@map("categorizations")
}

model PayeePattern {
  id                    String   @id @default(uuid())
  tenantId              String   @map("tenant_id")
  payeePattern          String   @map("payee_pattern") @db.VarChar(200)
  payeeAliases          Json     @default("[]") @map("payee_aliases")
  defaultAccountCode    String   @map("default_account_code") @db.VarChar(20)
  defaultAccountName    String   @map("default_account_name") @db.VarChar(100)
  confidenceBoost       Decimal  @default(0) @map("confidence_boost") @db.Decimal(5, 2)
  matchCount            Int      @default(0) @map("match_count")
  isRecurring           Boolean  @default(false) @map("is_recurring")
  expectedAmountCents   Int?     @map("expected_amount_cents")
  amountVariancePercent Decimal? @map("amount_variance_percent") @db.Decimal(5, 2)
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  tenant Tenant @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, payeePattern])
  @@index([tenantId])
  @@map("payee_patterns")
}

model FeeStructure {
  id                     String    @id @default(uuid())
  tenantId               String    @map("tenant_id")
  name                   String    @db.VarChar(100)
  description            String?
  feeType                FeeType   @map("fee_type")
  amountCents            Int       @map("amount_cents")
  vatInclusive           Boolean   @default(true) @map("vat_inclusive")
  siblingDiscountPercent Decimal?  @map("sibling_discount_percent") @db.Decimal(5, 2)
  effectiveFrom          DateTime  @map("effective_from") @db.Date
  effectiveTo            DateTime? @map("effective_to") @db.Date
  isActive               Boolean   @default(true) @map("is_active")
  createdAt              DateTime  @default(now()) @map("created_at")
  updatedAt              DateTime  @updatedAt @map("updated_at")

  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  enrollments Enrollment[]

  @@index([tenantId, isActive])
  @@index([tenantId, effectiveFrom])
  @@map("fee_structures")
}

model Enrollment {
  id                     String           @id @default(uuid())
  tenantId               String           @map("tenant_id")
  childId                String           @map("child_id")
  feeStructureId         String           @map("fee_structure_id")
  startDate              DateTime         @map("start_date") @db.Date
  endDate                DateTime?        @map("end_date") @db.Date
  status                 EnrollmentStatus @default(ACTIVE)
  siblingDiscountApplied Boolean          @default(false) @map("sibling_discount_applied")
  customFeeOverrideCents Int?             @map("custom_fee_override_cents")
  notes                  String?
  createdAt              DateTime         @default(now()) @map("created_at")
  updatedAt              DateTime         @updatedAt @map("updated_at")

  tenant       Tenant       @relation(fields: [tenantId], references: [id])
  child        Child        @relation(fields: [childId], references: [id], onDelete: Cascade)
  feeStructure FeeStructure @relation(fields: [feeStructureId], references: [id])

  @@index([tenantId, childId, status])
  @@index([tenantId, status, startDate])
  @@map("enrollments")
}

model Parent {
  id               String           @id @default(uuid())
  tenantId         String           @map("tenant_id")
  xeroContactId    String?          @unique @map("xero_contact_id")
  firstName        String           @map("first_name") @db.VarChar(100)
  lastName         String           @map("last_name") @db.VarChar(100)
  email            String?          @db.VarChar(255)
  phone            String?          @db.VarChar(20)
  whatsapp         String?          @db.VarChar(20)
  preferredContact PreferredContact @default(EMAIL) @map("preferred_contact")
  idNumber         String?          @map("id_number") @db.VarChar(20)
  address          String?
  notes            String?
  isActive         Boolean          @default(true) @map("is_active")
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")

  tenant    Tenant     @relation(fields: [tenantId], references: [id])
  children  Child[]
  invoices  Invoice[]
  reminders Reminder[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([tenantId, lastName, firstName])
  @@map("parents")
}

model Child {
  id               String   @id @default(uuid())
  tenantId         String   @map("tenant_id")
  parentId         String   @map("parent_id")
  firstName        String   @map("first_name") @db.VarChar(100)
  lastName         String   @map("last_name") @db.VarChar(100)
  dateOfBirth      DateTime @map("date_of_birth") @db.Date
  gender           Gender?
  medicalNotes     String?  @map("medical_notes")
  emergencyContact String?  @map("emergency_contact") @db.VarChar(200)
  emergencyPhone   String?  @map("emergency_phone") @db.VarChar(20)
  isActive         Boolean  @default(true) @map("is_active")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  parent      Parent       @relation(fields: [parentId], references: [id], onDelete: Cascade)
  enrollments Enrollment[]
  invoices    Invoice[]

  @@index([tenantId])
  @@index([tenantId, parentId])
  @@index([tenantId, isActive])
  @@map("children")
}

model Invoice {
  id                 String          @id @default(uuid())
  tenantId           String          @map("tenant_id")
  xeroInvoiceId      String?         @unique @map("xero_invoice_id")
  invoiceNumber      String          @map("invoice_number") @db.VarChar(50)
  parentId           String          @map("parent_id")
  childId            String          @map("child_id")
  billingPeriodStart DateTime        @map("billing_period_start") @db.Date
  billingPeriodEnd   DateTime        @map("billing_period_end") @db.Date
  issueDate          DateTime        @map("issue_date") @db.Date
  dueDate            DateTime        @map("due_date") @db.Date
  subtotalCents      Int             @map("subtotal_cents")
  vatCents           Int             @default(0) @map("vat_cents")
  totalCents         Int             @map("total_cents")
  amountPaidCents    Int             @default(0) @map("amount_paid_cents")
  status             InvoiceStatus   @default(DRAFT)
  deliveryMethod     DeliveryMethod? @map("delivery_method")
  deliveryStatus     DeliveryStatus? @map("delivery_status")
  deliveredAt        DateTime?       @map("delivered_at")
  deliveryRetryCount Int             @default(0) @map("delivery_retry_count")
  notes              String?
  isDeleted          Boolean         @default(false) @map("is_deleted")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")

  tenant    Tenant        @relation(fields: [tenantId], references: [id])
  parent    Parent        @relation(fields: [parentId], references: [id])
  child     Child         @relation(fields: [childId], references: [id])
  lines     InvoiceLine[]
  payments  Payment[]
  reminders Reminder[]

  @@unique([tenantId, invoiceNumber])
  @@index([tenantId, parentId])
  @@index([tenantId, status])
  @@index([tenantId, dueDate])
  @@index([xeroInvoiceId])
  @@map("invoices")
}

model InvoiceLine {
  id             String   @id @default(uuid())
  invoiceId      String   @map("invoice_id")
  description    String   @db.VarChar(500)
  quantity       Decimal  @default(1) @db.Decimal(10, 2)
  unitPriceCents Int      @map("unit_price_cents")
  discountCents  Int      @default(0) @map("discount_cents")
  subtotalCents  Int      @map("subtotal_cents")
  vatCents       Int      @default(0) @map("vat_cents")
  totalCents     Int      @map("total_cents")
  lineType       LineType @map("line_type")
  accountCode    String?  @map("account_code") @db.VarChar(20)
  sortOrder      Int      @default(0) @map("sort_order")
  createdAt      DateTime @default(now()) @map("created_at")

  invoice Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId, sortOrder])
  @@map("invoice_lines")
}

model Payment {
  id              String    @id @default(uuid())
  tenantId        String    @map("tenant_id")
  xeroPaymentId   String?   @unique @map("xero_payment_id")
  transactionId   String?   @map("transaction_id")
  invoiceId       String    @map("invoice_id")
  amountCents     Int       @map("amount_cents")
  paymentDate     DateTime  @map("payment_date") @db.Date
  reference       String?   @db.VarChar(100)
  matchType       MatchType @map("match_type")
  matchConfidence Decimal?  @map("match_confidence") @db.Decimal(5, 2)
  matchedBy       MatchedBy @map("matched_by")
  isReversed      Boolean   @default(false) @map("is_reversed")
  reversedAt      DateTime? @map("reversed_at")
  reversalReason  String?   @map("reversal_reason") @db.Text
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  tenant      Tenant       @relation(fields: [tenantId], references: [id])
  transaction Transaction? @relation(fields: [transactionId], references: [id])
  invoice     Invoice      @relation(fields: [invoiceId], references: [id])

  @@index([tenantId, transactionId])
  @@index([tenantId, invoiceId])
  @@index([xeroPaymentId])
  @@map("payments")
}

model Staff {
  id                String         @id @default(uuid())
  tenantId          String         @map("tenant_id")
  employeeNumber    String?        @map("employee_number") @db.VarChar(50)
  firstName         String         @map("first_name") @db.VarChar(100)
  lastName          String         @map("last_name") @db.VarChar(100)
  idNumber          String         @map("id_number") @db.VarChar(13)
  taxNumber         String?        @map("tax_number") @db.VarChar(20)
  email             String?        @db.VarChar(255)
  phone             String?        @db.VarChar(20)
  dateOfBirth       DateTime       @map("date_of_birth") @db.Date
  startDate         DateTime       @map("start_date") @db.Date
  endDate           DateTime?      @map("end_date") @db.Date
  employmentType    EmploymentType @map("employment_type")
  payFrequency      PayFrequency   @default(MONTHLY) @map("pay_frequency")
  basicSalaryCents  Int            @map("basic_salary_cents")
  bankName          String?        @map("bank_name") @db.VarChar(100)
  bankAccount       String?        @map("bank_account") @db.VarChar(20)
  bankBranchCode    String?        @map("bank_branch_code") @db.VarChar(10)
  medicalAidMembers Int            @default(0) @map("medical_aid_members")
  isActive          Boolean        @default(true) @map("is_active")
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  payrolls        Payroll[]

  @@unique([tenantId, idNumber])
  @@index([tenantId, isActive])
  @@map("staff")
}

model SarsSubmission {
  id              String           @id @default(uuid())
  tenantId        String           @map("tenant_id")
  submissionType  SubmissionType   @map("submission_type")
  periodStart     DateTime         @map("period_start") @db.Date
  periodEnd       DateTime         @map("period_end") @db.Date
  deadline        DateTime         @db.Date
  outputVatCents  Int?             @map("output_vat_cents")
  inputVatCents   Int?             @map("input_vat_cents")
  netVatCents     Int?             @map("net_vat_cents")
  totalPayeCents  Int?             @map("total_paye_cents")
  totalUifCents   Int?             @map("total_uif_cents")
  totalSdlCents   Int?             @map("total_sdl_cents")
  status          SubmissionStatus @default(DRAFT)
  submittedAt     DateTime?        @map("submitted_at")
  submittedBy     String?          @map("submitted_by")
  sarsReference   String?          @map("sars_reference") @db.VarChar(100)
  documentData    Json             @default("{}") @map("document_data")
  notes           String?          @db.Text
  isFinalized     Boolean          @default(false) @map("is_finalized")
  createdAt       DateTime         @default(now()) @map("created_at")
  updatedAt       DateTime         @updatedAt @map("updated_at")

  tenant          Tenant           @relation(fields: [tenantId], references: [id])
  submitter       User?            @relation(fields: [submittedBy], references: [id])

  @@unique([tenantId, submissionType, periodStart])
  @@index([tenantId, status])
  @@index([deadline])
  @@map("sars_submissions")
}

model Payroll {
  id                    String        @id @default(uuid())
  tenantId              String        @map("tenant_id")
  staffId               String        @map("staff_id")
  payPeriodStart        DateTime      @map("pay_period_start") @db.Date
  payPeriodEnd          DateTime      @map("pay_period_end") @db.Date
  basicSalaryCents      Int           @map("basic_salary_cents")
  overtimeCents         Int           @default(0) @map("overtime_cents")
  bonusCents            Int           @default(0) @map("bonus_cents")
  otherEarningsCents    Int           @default(0) @map("other_earnings_cents")
  grossSalaryCents      Int           @map("gross_salary_cents")
  payeCents             Int           @map("paye_cents")
  uifEmployeeCents      Int           @map("uif_employee_cents")
  uifEmployerCents      Int           @map("uif_employer_cents")
  otherDeductionsCents  Int           @default(0) @map("other_deductions_cents")
  netSalaryCents        Int           @map("net_salary_cents")
  medicalAidCreditCents Int           @default(0) @map("medical_aid_credit_cents")
  status                PayrollStatus @default(DRAFT)
  paymentDate           DateTime?     @map("payment_date") @db.Date
  createdAt             DateTime      @default(now()) @map("created_at")
  updatedAt             DateTime      @updatedAt @map("updated_at")

  tenant Tenant @relation(fields: [tenantId], references: [id])
  staff  Staff  @relation(fields: [staffId], references: [id])

  @@unique([tenantId, staffId, payPeriodStart])
  @@index([tenantId, status])
  @@index([tenantId, payPeriodStart])
  @@map("payrolls")
}

model Reconciliation {
  id                     String               @id @default(uuid())
  tenantId               String               @map("tenant_id")
  bankAccount            String               @map("bank_account") @db.VarChar(50)
  periodStart            DateTime             @map("period_start") @db.Date
  periodEnd              DateTime             @map("period_end") @db.Date
  openingBalanceCents    Int                  @map("opening_balance_cents")
  closingBalanceCents    Int                  @map("closing_balance_cents")
  calculatedBalanceCents Int                  @map("calculated_balance_cents")
  discrepancyCents       Int                  @default(0) @map("discrepancy_cents")
  status                 ReconciliationStatus @default(IN_PROGRESS)
  reconciledBy           String?              @map("reconciled_by")
  reconciledAt           DateTime?            @map("reconciled_at")
  notes                  String?              @db.Text
  createdAt              DateTime             @default(now()) @map("created_at")
  updatedAt              DateTime             @updatedAt @map("updated_at")

  tenant                 Tenant               @relation(fields: [tenantId], references: [id])
  reconciler             User?                @relation("ReconciliationReconciler", fields: [reconciledBy], references: [id])

  @@unique([tenantId, bankAccount, periodStart])
  @@index([tenantId, status])
  @@map("reconciliations")
}

model XeroToken {
  id                String   @id @default(uuid())
  tenantId          String   @unique @map("tenant_id")
  xeroTenantId      String   @map("xero_tenant_id")
  encryptedTokens   String   @map("encrypted_tokens") @db.Text
  tokenExpiresAt    DateTime @map("token_expires_at")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  tenant            Tenant   @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@map("xero_tokens")
}

model Reminder {
  id               String           @id @default(uuid())
  tenantId         String           @map("tenant_id")
  invoiceId        String           @map("invoice_id")
  parentId         String           @map("parent_id")
  escalationLevel  EscalationLevel  @map("escalation_level")
  deliveryMethod   DeliveryMethod   @map("delivery_method")
  reminderStatus   ReminderStatus   @default(PENDING) @map("reminder_status")
  scheduledFor     DateTime?        @map("scheduled_for")
  sentAt           DateTime?        @map("sent_at")
  deliveredAt      DateTime?        @map("delivered_at")
  readAt           DateTime?        @map("read_at")
  content          String           @db.Text
  subject          String?          @db.VarChar(500)
  failureReason    String?          @map("failure_reason") @db.Text
  createdAt        DateTime         @default(now()) @map("created_at")
  updatedAt        DateTime         @updatedAt @map("updated_at")

  tenant  Tenant  @relation(fields: [tenantId], references: [id])
  invoice Invoice @relation(fields: [invoiceId], references: [id])
  parent  Parent  @relation(fields: [parentId], references: [id])

  @@index([tenantId, invoiceId])
  @@index([tenantId, parentId])
  @@index([tenantId, scheduledFor])
  @@map("reminders")
}
